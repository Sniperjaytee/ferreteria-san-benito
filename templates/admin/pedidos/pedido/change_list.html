{% extends "admin/change_list.html" %}
{% load i18n static %}

{% block object-tools %}
        {{ block.super }}
            <a href="#" id="crear-reporte-btn" class="button" style="background:#0d6efd;color:#fff;margin-right:8px;padding:6px 10px;display:inline-flex;align-items:center;gap:8px;border-radius:6px;text-decoration:none;font-weight:600;">
                <svg width="14" height="14" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                    <rect x="3" y="13" width="3" height="8" rx="0" fill="#fff"></rect>
                    <rect x="9" y="9" width="3" height="12" rx="0" fill="#fff"></rect>
                    <rect x="15" y="5" width="3" height="16" rx="0" fill="#fff"></rect>
                </svg>
                <span>Crear reporte</span>
            </a>

        <script>
        (function(){
            var btn = document.getElementById('crear-reporte-btn');
            if (!btn) return;
            btn.addEventListener('click', function(e){
                e.preventDefault();
                var checkboxes = document.querySelectorAll('input.action-select');
                var any = false;
                checkboxes.forEach(function(ch){ if (ch.checked) any = true; });
                if (!any) { alert('Selecciona al menos un pedido para generar el reporte.'); return; }
                var actionSelect = document.querySelector('select[name="action"]');
                if (!actionSelect) { alert('No se encontró el selector de acciones del admin.'); return; }
                actionSelect.value = 'crear_reporte_pdf';
                var form = document.getElementById('changelist-form') || document.querySelector('form[action]');
                if (!form) { alert('No se encontró el formulario de la lista para enviar la acción.'); return; }
                form.submit();
            });
        })();
        </script>
{% endblock %}

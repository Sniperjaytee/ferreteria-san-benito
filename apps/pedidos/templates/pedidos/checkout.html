{% extends 'base.html' %}

{% block title %}Checkout{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-10">
  <h1 class="text-3xl font-semibold text-brand">Finaliza tu compra</h1>
  <p class="mt-2 text-sm text-base-sub">Confirma tus datos de entrega y el método de pago para procesar el pedido.</p>

  <div class="mt-8 grid gap-6 lg:grid-cols-[minmax(0,1.3fr)_minmax(0,0.7fr)]">
    <section class="rounded-2xl border border-base-border bg-base-bg p-6 shadow-card">
      <form method="post" enctype="multipart/form-data" class="space-y-5">
        {% csrf_token %}
        <div class="space-y-2">
          <label for="direccion_entrega" class="text-sm font-medium text-base-fg">Dirección de entrega</label>
          <textarea id="direccion_entrega" name="direccion_entrega" rows="3" required
                    class="w-full rounded-xl border border-base-border bg-white px-4 py-3 text-sm text-base-fg focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand/40">{{ direccion_entrega }}</textarea>
        </div>
        <div class="grid gap-5 sm:grid-cols-2">
          <div class="space-y-2">
            <label for="telefono_contacto" class="text-sm font-medium text-base-fg">Teléfono de contacto</label>
            <input id="telefono_contacto" type="text" name="telefono_contacto" value="{{ telefono_contacto }}" required
                   class="w-full rounded-xl border border-base-border bg-white px-4 py-3 text-sm text-base-fg focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand/40" />
          </div>
          <div class="space-y-2">
            <label for="metodo_pago" class="text-sm font-medium text-base-fg">Método de pago</label>
            <select id="metodo_pago" name="metodo_pago"
                    class="w-full rounded-xl border border-base-border bg-white px-4 py-3 text-sm text-base-fg focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand/40">
              <option value="efectivo">Efectivo</option>
              <option value="transferencia">Transferencia bancaria</option>
              <option value="pago_movil">Pago móvil</option>
              <option value="zelle">Zelle</option>
              <option value="paypal">PayPal</option>
              <option value="binance">Binance Pay</option>
              <option value="tarjeta">Tarjeta</option>
            </select>
          </div>
        </div>
        <div class="space-y-2">
          <label for="comprobante_pago" class="text-sm font-medium text-base-fg">Comprobante (opcional)</label>
          <input id="comprobante_pago" type="file" name="comprobante_pago"
                 class="w-full rounded-xl border border-dashed border-base-border bg-white px-4 py-3 text-sm focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand/40" />
        </div>
        <div class="space-y-2">
          <label for="notas_pago" class="text-sm font-medium text-base-fg">Notas</label>
          <textarea id="notas_pago" name="notas_pago" rows="3" placeholder="Detalles adicionales del pago"
                    class="w-full rounded-xl border border-base-border bg-white px-4 py-3 text-sm text-base-fg focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand/40"></textarea>
        </div>
        <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
          <p class="text-xs text-base-sub">Al confirmar aceptas nuestros términos y políticas de envío.</p>
          <button type="submit"
                  class="inline-flex items-center justify-center rounded-xl bg-brand px-6 py-3 text-sm font-semibold text-white shadow transition hover:bg-brand-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand/70">
            Confirmar pedido
          </button>
        </div>
      </form>
    </section>

    <aside class="space-y-4 rounded-2xl border border-base-border bg-base-bg p-6 shadow-card">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-semibold text-base-fg">Resumen</h2>
        <i class="fas fa-box text-brand"></i>
      </div>
      <ul class="space-y-3 text-sm text-base-sub">
        {% for it in items %}
        <li class="flex items-start justify-between gap-4">
          <span class="flex-1">{{ it.producto.nombre }} × {{ it.cantidad }}</span>
          <span class="font-medium text-base-fg">${{ it.subtotal }}</span>
        </li>
        {% endfor %}
      </ul>
      <div class="border-t border-base-border pt-4 text-base-fg">
        <div class="flex justify-between font-semibold">
          <span>Total</span>
          <span>${{ total }}</span>
        </div>
      </div>
      <div class="space-y-3 border-t border-base-border pt-4 text-xs text-base-sub">
        <div class="flex items-center gap-3">
          <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-brand/10 text-brand">
            <i class="fas fa-truck"></i>
          </span>
          <p>Envíos a todo el país en 48 horas hábiles.</p>
        </div>
        <div class="flex items-center gap-3">
          <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-brand/10 text-brand">
            <i class="fas fa-phone"></i>
          </span>
          <p>Soporte y confirmación de pago por WhatsApp.</p>
        </div>
      </div>
    </aside>
  </div>
</div>
{% endblock %}

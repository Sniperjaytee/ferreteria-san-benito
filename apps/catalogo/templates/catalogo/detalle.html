{% extends 'base.html' %}
{% load static precios %}

{% block title %}{{ producto.nombre }}{% endblock %}

{% block content %}
<main class="container mx-auto px-3 py-6 sm:px-4 sm:py-8">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <div>
      {% if producto.imagen %}
        <img class="w-full rounded-lg" src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}"/>
      {% else %}
        <img class="w-full rounded-lg" src="{% static 'img/madera.jpg' %}" alt="{{ producto.nombre }}"/>
      {% endif %}
    </div>
    <div>
      <h1 class="text-2xl font-bold mb-2">{{ producto.nombre }}</h1>
      <p class="text-gray-600 mb-4">{{ producto.descripcion }}</p>
      {% with m=moneda_actual %}
        {% if m and m != producto.moneda_precio %}
          {% precio_en_moneda producto m as precio_convertido %}
          <p class="text-primary text-3xl font-extrabold mb-1">{{ simbolo_moneda }}{{ precio_convertido|floatformat:2 }}</p>
          <p class="text-steel text-sm mb-6">({{ producto.precio_formateado }})</p>
        {% else %}
          <p class="text-primary text-3xl font-extrabold mb-6">{{ producto.precio_formateado }}</p>
        {% endif %}
      {% endwith %}
      <form action="{% url 'pedidos:carrito_agregar' %}" method="post" class="flex items-center gap-3">
        {% csrf_token %}
        <input type="hidden" name="product_id" value="{{ producto.id }}" />
        <input name="quantity" type="number" min="1" value="1" class="w-16 text-center border border-gray-300 rounded" />
        <button class="bg-primary hover:bg-black/80 text-white px-4 py-2 rounded-full">Añadir al carrito</button>
      </form>
      {% if not producto.disponible %}
      <p class="text-red-600 mt-3">No disponible actualmente.</p>
      {% endif %}
    </div>
  </div>

  {% if relacionados %}
  <section class="mt-12">
    <h2 class="text-xl font-semibold mb-4">También te puede interesar</h2>
    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
      {% for producto in relacionados %}
        {% include 'catalogo/_product_card.html' %}
      {% endfor %}
    </div>
  </section>
  {% endif %}
</main>
{% endblock %}

{% load static precios %}
<div class="bg-white rounded-lg shadow-sm overflow-hidden transition-all duration-300 hover:shadow-md hover:-translate-y-0.5">
  <a href="{% url 'catalogo:producto_detalle' slug=producto.slug %}">
    {% if producto.imagen %}
      <img class="aspect-square object-cover w-full" src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" />
    {% else %}
      <img class="aspect-square object-cover w-full" src="{% static 'img/madera.jpg' %}" alt="{{ producto.nombre }}" />
    {% endif %}
  </a>
  <div class="p-3 sm:p-4">
    <a href="{% url 'catalogo:producto_detalle' slug=producto.slug %}"><h3 class="font-bold text-sm sm:text-base mb-1 line-clamp-1">{{ producto.nombre }}</h3></a>
    <p class="text-gray-600 text-xs sm:text-sm mb-2 line-clamp-2">{{ producto.descripcion|truncatechars:80 }}</p>

    {% with m=moneda_actual %}
      {% if m and m != producto.moneda_precio %}
        {% precio_en_moneda producto m as precio_convertido %}
        <p class="text-primary font-bold text-base sm:text-lg">{{ simbolo_moneda }}{{ precio_convertido|floatformat:2 }}</p>
        <p class="text-gray-500 text-xs">({{ producto.precio_formateado }})</p>
      {% else %}
        <p class="text-primary font-bold text-base sm:text-lg">{{ producto.precio_formateado }}</p>
      {% endif %}
    {% endwith %}

    {% if producto.stock_bajo %}
      <p class="text-xs text-red-600 mt-1">Stock bajo</p>
    {% endif %}

    <form action="{% url 'pedidos:carrito_agregar' %}" method="post" class="mt-3 flex items-center justify-between gap-1">
      {% csrf_token %}
      <input type="hidden" name="product_id" value="{{ producto.id }}" />
      <div class="flex items-center border border-gray-300 rounded-full max-w-[120px]">
        <button type="button" class="px-3 py-1.5 text-gray-600 hover:bg-gray-100 rounded-l-full text-sm" onclick="var q=this.nextElementSibling; if(+q.value>1) q.value=+q.value-1;">-</button>
        <input name="quantity" type="number" min="1" value="1" class="w-10 text-center border-none focus:outline-none focus:ring-1 focus:ring-primary text-sm" />
        <button type="button" class="px-3 py-1.5 text-gray-600 hover:bg-gray-100 rounded-r-full text-sm" onclick="var q=this.previousElementSibling; q.value=+q.value+1;">+</button>
      </div>
      <button class="bg-primary hover:bg-black/80 text-white px-3 py-1.5 rounded-full text-sm font-medium flex items-center transition">
        <i class="fas fa-shopping-cart text-sm mr-1"></i>
        <span class="hidden sm:inline">AÃ±adir</span>
      </button>
    </form>
  </div>
</div>
